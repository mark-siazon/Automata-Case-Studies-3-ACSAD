---
import WebsiteCard from "../components/Card.astro";
import WebsiteDialog from "../components/Dialog.astro";
import Layout from "../layouts/Layout.astro";
import "../styles/globals.css";
import websitesData from "../data/websites.json";

const { websites } = websitesData;
const maxIndex = websites.length - 1;
---

<Layout title="III-ACSAD | Case Study Compilation">
  <main class="container mx-auto px-4 py-8">
    <div
      class="grid grid-cols-1 xs:grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6"
      role="list"
      aria-label="Website case studies"
    >
      {
        websites.map((website, index) => (
          <WebsiteCard {...website} index={index} />
        ))
      }
    </div>

    {
      websites.map((website, index) => (
        <WebsiteDialog {...website} index={index} maxIndex={maxIndex} />
      ))
    }
  </main>

  <script>
    // Add click event listeners to all cards
    document.querySelectorAll("[data-url]").forEach((card) => {
      card.addEventListener("click", () => {
        const index = card.getAttribute("data-index");
        if (index !== null) {
          const showDialog = (window as any)[`showWebsiteDialog${index}`];
          if (typeof showDialog === "function") {
            showDialog();
          }
        }
      });
    });

    // Add loading state
    window.addEventListener("load", () => {
      document.body.classList.add("loaded");
      
      // Animate cards on page load
      document.querySelectorAll("[data-url]").forEach((card, index) => {
        setTimeout(() => {
          card.classList.add("animate-loaded");
        }, 100 + (index * 100)); // Staggered animation
      });
    });

    // Add View Transitions API support
    document.addEventListener('astro:page-load', () => {
      // This runs on every page navigation
      document.querySelectorAll("[data-url]").forEach((card) => {
        card.addEventListener("click", () => {
          const index = card.getAttribute("data-index");
          if (index !== null) {
            const showDialog = (window as any)[`showWebsiteDialog${index}`];
            if (typeof showDialog === "function") {
              showDialog();
            }
          }
        });
      });
    });
  </script>
</Layout>

<style>
  /* Loading state styles */
  body {
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
  }

  body.loaded {
    opacity: 1;
  }

  /* Improve focus styles */
  :focus-visible {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
  }

  /* Improve scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #666;
  }

  /* Add view transition animations */
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation-duration: 0.3s;
  }

  ::view-transition-old(card-*),
  ::view-transition-new(card-*) {
    animation-duration: 0.5s;
  }

  ::view-transition-old(img-*),
  ::view-transition-new(img-*) {
    animation-duration: 0.4s;
  }
</style>
